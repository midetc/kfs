# Облік показників двофазного лічильника "день-ніч"

Ця програма допомагає вести облік показів лічильника електроенергії, розраховувати споживання та виставляти рахунки за різними тарифами (день/ніч). Програма також автоматично виправляє покази, якщо вони зменшилися, і зберігає історію показників.

## Що робить програма

- Приймає покази лічильника (як денні, так і нічні);
- Порівнює нові покази з попередніми;
- Розраховує вартість електроенергії за денним і нічним тарифами;
- Працює як з новими, так і з існуючими лічильниками;
- Автоматично коригує покази, якщо вони зменшилися;
- Зберігає історію показів;
- Має зручний консольний інтерфейс.

## Режими роботи програми

Програму можна запускати трьома способами:

1. **Простий режим з файловим сховищем:**  
   Запустіть за допомогою:
   ```bash
   python meter_billing.py
   ```

2. **Режим з базою даних PostgreSQL:**  
   Спочатку налаштуйте параметри підключення у файлі `.env`, потім запустіть:
   ```bash
   python db_meter_billing.py
   ```

3. **Мікросервісна архітектура (RabbitMQ та PostgreSQL):**  
   Запустіть всі компоненти через Docker Compose:
   ```bash
   docker-compose up -d
   ```

### Як запускати окремі компоненти мікросервісної архітектури

- **Обробка показників:**
  ```bash
  python microservices/billing_worker.py
  ```
- **Генератор показників для тестування:**
  ```bash
  python microservices/readings_generator.py
  ```
- **Споживач результатів:**
  ```bash
  python microservices/results_consumer.py
  ```
- **API сервер:**
  ```bash
  python api/app.py
  ```

## API ендпоінти

Програма надає REST API для роботи з даними:

- `GET /meters` – отримання списку всіх лічильників;
- `GET /meters/{meter_id}` – отримання даних конкретного лічильника;
- `POST /readings` – відправка нових показників;
- `GET /history` – отримання історії показників усіх лічильників;
- `GET /history/{meter_id}` – отримання історії показників конкретного лічильника.

## Тестування

Для перевірки роботи програми можна запустити тести:

- **Для простого режиму:**
  ```bash
  python test_meter_billing.py
  ```
- **Для режиму з базою даних (з моками):**
  ```bash
  python test_db_meter_billing.py
  ```

## Налаштування

Основні параметри, такі як тарифи та корекція показів, можна змінити у файлі `.env`. Наприклад:
```
# Тарифи
DAY_TARIFF=1.68
NIGHT_TARIFF=0.84
DAY_ROLLOVER=100
NIGHT_ROLLOVER=80
```

## Структура проекту

- **meter_billing.py** – проста версія з файловим сховищем;
- **db_storage.py** – модуль для роботи з PostgreSQL;
- **db_meter_billing.py** – версія з базою даних;
- **microservices/** – компоненти мікросервісної архітектури;
- **api/** – REST API для взаємодії з системою;
- **services/** – спільні сервіси для мікросервісної архітектури;
- **test_*.py** – тести для різних режимів роботи.

---

Цей варіант README написаний простою мовою, щоб кожен міг швидко зрозуміти, як користуватися системою.
