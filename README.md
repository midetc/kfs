# Система обліку показників двофазного лічильника "день-ніч"

Програма, яка обробляє показники двофазного лічильника електроенергії "день-ніч", розраховує споживання та генерує рахунки на основі різних тарифів.

## Функціональність

- Обробка показників лічильника (денних та нічних)
- Розрахунок різниці між поточними та попередніми показниками
- Виставлення рахунків за різними тарифами (день/ніч)
- Обробка нових та існуючих лічильників
- Автоматична "накрутка" показників (у випадку зниження показників)
- Зберігання історії показників
- Зручний консольний інтерфейс

## Варіанти запуску

Система може працювати у трьох режимах:

1. Простий режим з файловим сховищем (meter_billing.py)
2. Режим з базою даних PostgreSQL (db_meter_billing.py)
3. Мікросервісна архітектура з RabbitMQ та PostgreSQL (через Docker)

## Вимоги

- Python 3.6+
- Для режиму з базою даних: PostgreSQL
- Для мікросервісної архітектури: Docker та Docker Compose

## Запуск в простому режимі

```bash
python meter_billing.py
```

## Запуск з використанням бази даних

Спочатку налаштуйте параметри підключення до PostgreSQL у файлі `.env`, потім:

```bash
python db_meter_billing.py
```

## Запуск мікросервісної архітектури

Запуск усіх компонентів через Docker Compose:

```bash
docker-compose up -d
```

### Запуск окремих компонентів мікросервісної архітектури

Запуск мікросервісу обробки показників:

```bash
python microservices/billing_worker.py
```

Запуск генератора показників для тестування:

```bash
python microservices/readings_generator.py
```

Запуск споживача результатів:

```bash
python microservices/results_consumer.py
```

Запуск API сервера:

```bash
python api/app.py
```

## API ендпоінти

- `GET /meters` - отримання списку всіх лічильників
- `GET /meters/{meter_id}` - отримання даних конкретного лічильника
- `POST /readings` - відправка нових показників лічильника
- `GET /history` - отримання історії показників усіх лічильників
- `GET /history/{meter_id}` - отримання історії показників конкретного лічильника

## Тести

Для запуску тестів простого режиму:

```bash
python test_meter_billing.py
```

Для запуску тестів режиму з базою даних (з моками):

```bash
python test_db_meter_billing.py
```

## Налаштування

Основні параметри (тарифи, накрутки) можна змінити у файлі `.env`:

```
# Налаштування тарифів
DAY_TARIFF=1.68
NIGHT_TARIFF=0.84
DAY_ROLLOVER=100
NIGHT_ROLLOVER=80
```

## Структура проекту

- `meter_billing.py` - проста версія з файловим сховищем
- `db_storage.py` - модуль для роботи з базою даних PostgreSQL
- `db_meter_billing.py` - версія з використанням бази даних
- `microservices/` - компоненти мікросервісної архітектури
- `api/` - REST API для взаємодії з системою
- `services/` - загальні сервіси для мікросервісної архітектури
- `test_*.py` - тести для різних режимів роботи 